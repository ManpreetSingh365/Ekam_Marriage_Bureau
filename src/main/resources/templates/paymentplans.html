<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{base :: parent(~{::#content},~{::title},~{::script})}">

<head>
	<title>Payment Plans</title>
	<link href="https://cdn.jsdelivr.net/npm/flowbite@2.4.1/dist/flowbite.min.css" rel="stylesheet" />

</head>

<body>
	<!--		<marquee class="index-adv" behavior="scroll" direction="left" scrollamount="20" onmouseover="this.stop()"
			onmouseout="this.start()"
			style="color: var(--orange); padding: 10px; font-weight: bolder; text-align: center; border-radius: 100px; overflow: hidden; backdrop-filter: blur(7px);">
			Your upward scrolling text goes here
		</marquee>-->
	<div id="content">
		<div id="bgImage10" class="flex flex-col items-center bg-cover bg-center min-h-screen">
			<h1
				class="my-10 text-lg sm:text-xl md:text-2xl lg:text-3xl xl:text-4xl text-center text-white font-bold selfWritter">
				Unlock Your Best Match with Our Genuine Plans
			</h1>

			<div class="flex flex-wrap justify-center gap-6">
				<!-- GOLD Plan -->
				<div
					class="relative bg-transparent text-white px-8 py-6 rounded-lg text-center transition transform scale-105 shadow-lg border-6 border-dashed border-orange cursor-pointer hover-shadow-orange">
					<h2 class="text-xl font-semibold mb-2">GOLD</h2>
					<div class="text-2xl mb-4">₹<span th:text="${GOLD_PLAN_PRICE}"></span> / 1 month</div>
					<ul class="text-left mb-4 space-y-2">
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							Connect directly with Matches</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							View detailed Profile information</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							View Contact number</li>
					</ul>
					<div>
						<div th:if="${authOptional}">
							<button id="gold-button" onclick="startGoldPlan()"
								class="fancy-button w-4/5 py-2 mt-4 bg-orange-500 text-white rounded-lg text-sm font-semibold">
								Let's Subscribe
							</button>
						</div>
						<div th:if="${!authOptional}">
							<a th:href="@{'/logintopay'}">
								<button
									class="fancy-button w-4/5 p-3 mt-4 bg-orange-500 text-white rounded-lg text-sm font-semibold">
									Get Started
								</button>
							</a>
						</div>
					</div>
				</div>

				<!-- DIAMOND Plan -->
				<div
					class="relative bg-transparent text-white px-8 py-6 rounded-lg text-center transition transform scale-105 shadow-lg border-6 border-dashed border-orange cursor-pointer hover-shadow-orange">
					<span
						class="absolute top-0 -translate-y-1/2 left-1/2 -translate-x-1/2 bg-orange-500 text-white px-6 py-1 rounded-full text-sm font-semibold">
						Most Popular
					</span>
					<h2 class="text-xl font-semibold mb-2">DIAMOND</h2>
					<div class="text-2xl mb-4">₹<span th:text="${DIAMOND_PLAN_PRICE}"></span> / 3 months</div>
					<ul class="text-left mb-4 space-y-2">
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							Connect directly with Matches</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							View detailed Profile information</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							Get Highlighted to your Matches</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							View Contact number</li>
					</ul>
					<div>
						<div th:if="${authOptional}">
							<button id="diamond-button" onclick="startDiamondPlan()"
								class="fancy-button w-4/5 py-2 mt-4 bg-orange-500 text-white rounded-lg text-sm font-semibold">
								Let's Subscribe
							</button>
						</div>
						<div th:if="${!authOptional}">
							<a th:href="@{'/logintopay'}">
								<button
									class="fancy-button w-4/5 p-3 mt-4 bg-orange-500 text-white rounded-lg text-sm font-semibold">
									Get Started
								</button>
							</a>
						</div>
					</div>
				</div>

				<!-- PLATINUM Plan -->
				<div
					class="relative bg-transparent text-white px-8 py-6 rounded-lg text-center transition transform scale-105 shadow-lg border-6 border-dashed border-orange cursor-pointer hover-shadow-orange">
					<h2 class="text-xl font-semibold mb-2">PLATINUM</h2>
					<div class="text-2xl mb-4">₹<span th:text="${PLATINUM_PLAN_PRICE}"></span> / Life Time</div>
					<ul class="text-left mb-4 space-y-2">
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							Dedicated Relationship Advisor</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							Introduction and Meeting</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							Handpicked Matches</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							Be featured under Spotlight</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							Standout with Bold Listing</li>
						<li class="flex items-center text-sm"><i class="fas fa-check-circle text-orange-500 mr-2"></i>
							All Other Premium Benefits</li>
					</ul>
					<div>
						<div th:if="${authOptional}">
							<button id="platinum-button" onclick="startPlatinumPlan()"
								class="fancy-button w-4/5 py-2 mt-4 bg-orange-500 text-white rounded-lg text-sm font-semibold">
								Let's Subscribe
							</button>
						</div>
						<div th:if="${!authOptional}">
							<a th:href="@{'/logintopay'}">
								<button
									class="fancy-button w-4/5 p-3 mt-4 bg-orange-500 text-white rounded-lg text-sm font-semibold">
									Get Started
								</button>
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.7.0.min.js"
		integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
		crossorigin="anonymous"></script>

	<script th:inline="javascript">
		console.log("Payment Plans page");
		// RazorPay Payment...........

		/* This will insert the plan prices directly into JavaScript variables */
		var GOLD_PLAN_PRICE = [[${GOLD_PLAN_PRICE}]];
		var DIAMOND_PLAN_PRICE = [[${DIAMOND_PLAN_PRICE}]];
		var PLATINUM_PLAN_PRICE = [[${PLATINUM_PLAN_PRICE}]];


		// Create a separate function for each plan to avoid code duplication
		const startGoldPlan = () => {
			paymentStart(GOLD_PLAN_PRICE, 30, "days"); // 1 month validity
		};

		const startDiamondPlan = () => {
			paymentStart(DIAMOND_PLAN_PRICE, 6, "months"); // 3 months validity
		};

		const startPlatinumPlan = () => {
			paymentStart(PLATINUM_PLAN_PRICE, 1, "years"); // Lifetime validity
			//paymentStart(3, Infinity, "Platinum"); // Lifetime validity
		};

		// Create a separate function to handle errors
		const handleError = (error) => {
			console.log(error);
			alert("Something went wrong!!");
		};

		// Create a separate function to handle payment response
		const handlePaymentResponse = (response) => {
			console.log(response);
			alert("Payment response stored successfully");
		};

		// Refactored paymentStart function
		const paymentStart = (amount, validityPeriod, validityType) => {
			console.log("Payment Started");
			console.log("Amount ehh Hga: " + amount);
			console.log("Validity Period ehh Hgi: " + validityPeriod);
			console.log("Validity Type ehh Hgi: " + validityType);
			if (amount == "" || amount == null) {
				alert("Amount is required!!");
				return;
			}

			// Code: We'll use ajax to send request to server to create order
			$.ajax({
				url: "/create_order",
				data: JSON.stringify({amount: amount, info: "order_request", validityPeriod: validityPeriod, validityType: validityType}),
				contentType: "application/json",
				type: "POST",
				dataType: "json",
				success: function (response) {
					// invode razorpay
					console.log(response);
					if (response.status == "created") {
						// open payment form
						let options = {
							key: "rzp_test_PceptBJlOEtHdK",
							amount: response.amt,
							"currency": "INR",
							"name": "Ekam Marriage Bureau",
							"description": "Perfect Matches, Real Connections, and Easy Marriages Await You!",
							"image": "https://res.cloudinary.com/dcrlfty5k/image/upload/v1730366358/d459c434-00ea-4cff-9b7d-c7f18c7023e3.png",
							"order_id": response.id,
							// Inside your Razorpay payment handler
							handler: function (response) {
								console.log(response.razorpay_payment_id);
								console.log(response.razorpay_order_id);
								console.log(response.razorpay_signature);
								console.log("Payment done");

								// Send payment response to server to store
								$.ajax({
									url: "/payment-response",
									data: JSON.stringify({
										razorpayPaymentId: response.razorpay_payment_id,
										razorpayOrderId: response.razorpay_order_id,
										razorpaySignature: response.razorpay_signature,
										validityPeriod: validityPeriod,
										validityType: validityType
									}),
									contentType: "application/json",
									type: "POST",
									dataType: "json",
									success: function (response) {
										if (response.redirect) {
											window.location.href = response.redirectUrl; // Redirect to the desired page
										} else {
											alert("Payment response stored successfully");
										}
									},
									error: function (xhr, status, error) {
										console.error("Error storing payment response:", error);
										alert("An error occurred while processing your payment.");
									}
								});
							},

							"prefill": {
								"name": "name",
								"email": "name@example.com",
								"contact": "0123456789"
							},
							"notes": {
								"address": "S.W Road"
							},
							"theme": {
								"color": "#3399cc"
							}
						};
						var rzp1 = new Razorpay(options);
						rzp1.on('payment.failed', function (response) {
							console.log(response.error.code);
							console.log(response.error.description);
							console.log(response.error.source);
							console.log(response.error.step);
							console.log(response.error.reason);
							console.log(response.error.metadata.order_id);
							console.log(response.error.metadata.payment_id);
						});

						rzp1.open();

					}
				},
				error: handleError
			});
		};

	</script>


	<!--
		contentType: "application/json",
									type: "POST",
									dataType: "json",
									success: handlePaymentResponse,
									error: handleError // Need to add............
								});
-->
</body>

</html>